# Docker Compose for Production (HTTPS)
# ======================================
# Usage: docker-compose -f docker-compose.prod.yml up -d
#
# Prerequisites:
#   1. Place SSL certificates in this directory:
#      - cert.pem (certificate)
#      - privkey.pem (private key)
#   2. Set API_TOKEN in .env or environment
#   3. Optionally set HTTPS_PORT (default: 8443)
#
# Example with custom port:
#   HTTPS_PORT=9443 docker-compose -f docker-compose.prod.yml up -d

version: '3.8'

services:
  backend:
    build: .
    container_name: onlinestatus-backend
    ports:
      - "${HTTPS_PORT:-8443}:8000"
    environment:
      - API_TOKEN=${API_TOKEN:-dev-token-change-me}
      - USE_MOCK_DATA=${USE_MOCK_DATA:-false}
    volumes:
      - ./cert.pem:/app/cert.pem:ro
      - ./privkey.pem:/app/privkey.pem:ro
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "-k", "https://localhost:8000/healthz"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
